# 動画メタデータ自動生成システム 要件定義書

## 1. はじめに

### 1.1 背景

現在、動画コンテンツの内容把握やアーカイブ化において、人手による視聴と記録作成に多大な工数がかかっている。生成AI（Gemini）の動画認識能力を活用し、このプロセスを自動化したい。

### 1.2 目的・ゴール

動画ファイルをアップロードするだけで、AIがその内容を時系列で詳細に分析し、アーカイブ用のメタデータ（出演者、内容要約、テロップ等）を自動生成してダウンロードできるシステムを構築する。

## 2. 対象範囲 (スコープ)

### 2.1 システム化の範囲

| コンポーネント | 説明 |
|--------------|------|
| Webフロントエンド（簡易UI） | ユーザーが操作する画面一式（複数ファイル同時アップロード対応） |
| バックエンドAPI | 動画の受け付け、AI処理の実行、結果の返却を行うAPI（バッチ処理対応） |
| AIモデル | Google Gemini API（動画分析機能）を利用 |
| ワークフロー管理 | Step Functionsによる非同期処理・キャンセル機能 |

### 2.2 ターゲットユーザー

- 動画管理者
- アーカイビスト
- コンテンツ管理担当者

## 3. 機能要件

### 3.1 処理フロー

1. 受け取った動画ファイルをS3へアップロード（マルチパートアップロード対応、最大100GB）
2. 大容量ファイル・MXFファイルはMediaConvertでProxy動画に変換
3. Geminiモデル（gemini-2.5-pro）に対し、定義済みのシステムプロンプトと動画を送信
4. AIからのレスポンス（Markdownテーブル形式のテキスト）をパース
5. パースに失敗した場合、フォーマット修正用のGemini（gemini-2.0-flash）を使用して出力形式を修正し、再度パースを試行（最大3回）

### 3.2 入出力仕様

- **入力 (Input)**: 動画ファイル（MP4/MXF形式、複数ファイル一括アップロード可、最大100GB/ファイル）
- **出力 (Output)**: 生成されたメタデータ（CSV形式、個別・一括ZIPダウンロード対応）

### 3.3 複数動画対応要件

| 要件 | 詳細 |
|------|------|
| 複数ファイル処理 | 一度に最大50ファイルまで同時処理可能 |
| 進捗表示 | 各動画の処理状況をリアルタイム表示 |
| 目視確認 | サムネイル表示で投入動画を目視確認可能 |
| 全体プログレスバー | 全体の処理進捗を一目で把握可能 |
| キャンセル機能 | 個別・全体のジョブキャンセルが可能 |
| 一括ダウンロード | 完了分をZIP形式で一括ダウンロード |

### 3.4 メタデータ定義（AI出力仕様）

プロンプトの指示に基づき、AIは以下の項目を時系列（セグメントごと）に出力する。

| 項目名 | 内容 | 例 |
|-------|------|-----|
| タイムスタンプ | 開始時刻 | 00:00:00 |
| 画面構成 | スタジオ、中継、VTR等の種別 | スタジオ |
| 出演者 | 画面に映っている人物 | 田中アナ(男) |
| 内容要約 | 発言や状況の要約 | オープニング挨拶 |
| テロップ | 画面上のテキスト情報 | CCNニュース 18:00 |
| 備考 | その他特記事項 | - |

## 4. 非機能要件

### 4.1 精度に関する注意

- AI生成のため誤認識の可能性がある
- 最終確認は人間が行う前提とする

### 4.2 技術スタック

| レイヤー | 技術 | 理由 |
|---------|------|------|
| Backend | Python (Lambda + Flask) | AWS Lambdaでデプロイ、ローカル開発はFlask使用。Gemini SDKとの親和性が高い |
| Frontend | シンプルなHTML/CSS/JS | ビルド不要、即デプロイ可能 |
| Infrastructure | AWS Lambda + API Gateway + Lambda Function URL | サーバーレス、スケーラブル、長時間処理対応 |
| 認証 | Cognito User Pool | マネージドな認証サービス、Hosted UIでログイン画面提供 |
| 配信 | CloudFront + S3 | HTTPS対応、セキュアな静的配信 |
| ストレージ | S3 | 動画の一時保存（分析後削除） |
| セキュリティ | WAF（オプション） | レート制限、AWS Managed Rules による脅威対策 |
